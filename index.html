<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cybersecurity Career Questionnaire - Dark Mode Premium</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #0e0e14;
            color: #fff;
            font-family: "Poppins", sans-serif;
        }

        .center-box {
            max-width: 650px;
            margin: auto;
            margin-top: 50px;
            background: #14141c;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.12);
        }

        .neon-title {
            background: linear-gradient(90deg, #00ffff, #00aaff);
            -webkit-background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .btn-premium {
            background: linear-gradient(90deg, #0099ff, #00ffff);
            border: none;
            color: #000;
            font-weight: bold;
            padding: 10px 30px;
            border-radius: 50px;
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
            transition: 0.3s;
        }

        .btn-premium:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.7);
        }

        .question-image {
            border-radius: 10px;
            width: 100%;
            margin-bottom: 12px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.12);
        }

        /* Custom radio buttons */
        .option-box {
            background: #1e1e29;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.25s;
        }

        .option-box {
            font-size: 0.75rem !important;
            /* kecil tapi tetap terbaca */
            padding: 8px 10px !important;
            /* sedikit dipadatkan */
        }

        .option-box input {
            transform: scale(1);
            /* perkecil sedikit radio button */
            margin-right: 10px;
        }


        .option-box:hover {
            border: 2px solid #00ffff;
            background: #232331;
        }

        .option-box input {
            margin-right: 12px;
            transform: scale(1.4);
            accent-color: #00ffff;
        }

        /* Animation */
        .fade-slide-enter {
            opacity: 0;
            transform: translateX(25px);
        }

        .fade-slide-enter-active {
            opacity: 1;
            transform: translateX(0);
            transition: all 0.6s ease;
        }

        .fade-slide-exit {
            opacity: 1;
            transform: translateX(0);
        }

        .fade-slide-exit-active {
            opacity: 0;
            transform: translateX(-25px);
            transition: all 0.6s ease;
        }

        .image-col {
            display: flex;
            align-items: center;
        }

        .question-image {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 12px;
        }

        .result-section h5 {
            color: #00ffff;
            margin-top: 15px;
            border-bottom: 1px solid #1e1e29;
            padding-bottom: 5px;
        }

        .result-list {
            list-style: none;
            padding-left: 0;
        }

        .result-list li {
            background: #1e1e29;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        /* Loading specific styles */
        #loading-text {
            min-height: 40px;
            /* Jaga agar teks loading tidak melompat-lompat */
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="center-box text-center" id="start-screen">
            <h2 class="neon-title">Cybersecurity Career Path Recommendation</h2>
            <p class="text-secondary">Jawab 20 pertanyaan untuk menemukan karir cybersecurity yang cocok untuk Anda.</p>

            <button class="btn-premium mt-3" onclick="startQuiz()">Start</button>
        </div>

        <div class="center-box" id="question-screen" style="display:none;">
            <div id="question-content"></div>

            <div class="d-flex justify-content-between mt-4">
                <button class="btn btn-secondary rounded-pill px-4" onclick="prevQuestion()">Back</button>
                <button class="btn-premium" onclick="nextQuestion()">Next</button>
            </div>
        </div>

        <div class="center-box text-center" id="loading-screen" style="display:none;">
            <div class="spinner-border text-info"></div>
            <!-- ID baru untuk teks loading -->
            <p class="mt-3" id="loading-text">Sedang menghitung prediksi kecocokan karir...</p>
        </div>

        <div class="center-box" id="result-screen" style="display:none;">
            <h3 class="neon-title text-center mb-3">Hasil Rekomendasi Karir</h3>
            <div id="result"></div>
        </div>

    </div>

    <script>
        // Gunakan fungsi alert yang lebih halus, karena window.alert() dilarang
        function showMessage(message) {
            // Kita akan menggunakan HTML kustom sederhana sebagai pengganti alert
            const alertBox = document.createElement('div');
            alertBox.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: #ff4757; color: white;
                padding: 15px 25px; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: fadeInOut 3s ease-in-out;
            `;
            alertBox.innerHTML = `<strong>Peringatan!</strong><br>${message}`;
            document.body.appendChild(alertBox);

            // CSS Animation keyframes (karena tidak bisa di style tag di file ini)
            // Asumsi CSS ini akan diproses oleh lingkungan Canvas
            if (typeof window.fadeInOutDefined === 'undefined') {
                const style = document.createElement('style');
                style.innerHTML = `
                    @keyframes fadeInOut {
                        0%, 100% { opacity: 0; transform: translateY(-20px); }
                        10%, 90% { opacity: 1; transform: translateY(0); }
                    }
                `;
                document.head.appendChild(style);
                window.fadeInOutDefined = true;
            }

            setTimeout(() => alertBox.remove(), 3000);
        }

        // Fungsi baru untuk memperbarui teks loading
        function updateLoadingText(text) {
            document.getElementById("loading-text").innerText = text;
        }

        const questions = [
            "1. Apakah Anda tertarik mencari dan menganalisis celah keamanan pada aplikasi?",
            "2. Apakah Anda suka mencoba menembus sistem untuk menguji keamanannya (ethical hacking)?",
            "3. Apakah Anda ingin memahami cara kerja program dengan membongkar atau reverse engineering?",
            "4. Apakah Anda menikmati simulasi serangan seperti CTF atau praktik penetration testing?",
            "5. Apakah Anda tertarik memantau log dan trafik jaringan untuk mendeteksi aktivitas mencurigakan?",
            "6. Apakah Anda suka menganalisis insiden keamanan dan mencari penyebabnya?",
            "7. Apakah Anda ingin belajar alat seperti SIEM, IDS, atau IPS untuk mendeteksi serangan?",
            "8. Apakah Anda tertarik membongkar malware untuk memahami cara kerjanya?",
            "9. Apakah Anda suka debugging kode biner atau memeriksa program tingkat rendah?",
            "10. Apakah Anda ingin mempelajari teknik digital forensics untuk menginvestigasi bukti digital?",
            "11. Apakah Anda suka menganalisis artefak sistem seperti registry, logs, atau file sistem?",
            "12. Apakah Anda tertarik merancang arsitektur jaringan yang aman?",
            "13. Apakah Anda suka menganalisis dan memahami pola trafik jaringan?",
            "14. Apakah Anda ingin mempelajari keamanan cloud seperti AWS, GCP, atau Azure?",
            "15. Apakah Anda tertarik konsep zero trust, IAM, dan pengelolaan akses pengguna?",
            "16. Apakah Anda suka memperbaiki atau memperkuat kode agar tidak punya vulnerability?",
            "17. Apakah Anda tertarik secure coding atau integrasi keamanan di DevOps (DevSecOps)?",
            "18. Apakah Anda suka mempelajari taktik, teknik, dan prosedur yang digunakan attacker?",
            "19. Apakah Anda tertarik mengumpulkan dan menganalisis informasi ancaman (threat intelligence)?",
            "20. Apakah Anda ingin memahami kebijakan keamanan, compliance, dan audit TI?"
        ];


        // Dummy images â€” Replace with your own
        const images = [
            "https://placehold.co/400x250/0077b6/ffffff?text=App+Sec",
            "https://placehold.co/400x250/0077b6/ffffff?text=Exploit",
            "https://placehold.co/400x250/0077b6/ffffff?text=Reverse+Eng",
            "https://placehold.co/400x250/0077b6/ffffff?text=Pentest",
            "https://placehold.co/400x250/0077b6/ffffff?text=Monitoring",
            "https://placehold.co/400x250/0077b6/ffffff?text=Incident+Analysis",
            "https://placehold.co/400x250/0077b6/ffffff?text=SIEM",
            "https://placehold.co/400x250/0077b6/ffffff?text=Malware",
            "https://placehold.co/400x250/0077b6/ffffff?text=Debugging",
            "https://placehold.co/400x250/0077b6/ffffff?text=Forensics",
            "https://placehold.co/400x250/0077b6/ffffff?text=Artifacts",
            "https://placehold.co/400x250/0077b6/ffffff?text=Network+Arch",
            "https://placehold.co/400x250/0077b6/ffffff?text=Net+Traffic",
            "https://placehold.co/400x250/0077b6/ffffff?text=Cloud+Sec",
            "https://placehold.co/400x250/0077b6/ffffff?text=Zero+Trust",
            "https://placehold.co/400x250/0077b6/ffffff?text=Vulnerability",
            "https://placehold.co/400x250/0077b6/ffffff?text=DevSecOps",
            "https://placehold.co/400x250/0077b6/ffffff?text=TTP",
            "https://placehold.co/400x250/0077b6/ffffff?text=Threat+Intel",
            "https://placehold.co/400x250/0077b6/ffffff?text=GRC"
        ];

        let currentIndex = -1;
        let answers = {};

        // --- Start Quiz ---
        function startQuiz() {
            currentIndex = 0;
            document.getElementById("start-screen").style.display = "none";
            document.getElementById("question-screen").style.display = "block";
            loadQuestion(true);
        }

        // Load question with animation
        function loadQuestion(enter = true) {
            const questionBox = document.getElementById("question-content");

            // Pastikan data gambar ada sebelum diakses
            const imageSrc = images[currentIndex] || `https://placehold.co/400x250/0077b6/ffffff?text=Image+Missing`;

            questionBox.className = enter ? "fade-slide-enter" : "fade-slide-exit";

            setTimeout(() => {
                questionBox.innerHTML = `
        
        <!-- ROW 1: QUESTION FULL WIDTH -->
        <div class="row mb-3">
            <div class="col-12 text-center">
                <h4 class="mb-3">${questions[currentIndex]}</h4>
            </div>
        </div>

        <!-- ROW 2: IMAGE & OPTIONS -->
        <div class="row g-3">

            <!-- LEFT COLUMN: IMAGE -->
            <div class="col-md-7 image-col">
                <img src="${imageSrc}" class="question-image shadow-lg" onerror="this.onerror=null;this.src='https://placehold.co/400x250/0077b6/ffffff?text=No+Image';">
            </div>

            <!-- RIGHT COLUMN: ANSWERS -->
            <div class="col-md-5">

                ${generateOption("1 - Sangat Tidak Tertarik", 1)}
                ${generateOption("2 - Tidak Tertarik", 2)}
                ${generateOption("3 - Netral", 3)}
                ${generateOption("4 - Tertarik", 4)}
                ${generateOption("5 - Sangat Tertarik", 5)}

            </div>
        </div>
        `;

                questionBox.className = enter ?
                    "fade-slide-enter-active" :
                    "fade-slide-exit-active";

            }, 50);
        }



        function generateOption(text, value) {
            const checked = answers[currentIndex] == value ? "checked" : "";
            return `
        <label class="option-box">
            <input type="radio" name="q${currentIndex}" value="${value}" ${checked}
                onclick="answers[currentIndex] = ${value}">
            ${text}
        </label>
    `;
        }

        // Next Question
        function nextQuestion() {
            if (!answers[currentIndex]) {
                showMessage("Anda harus memilih jawaban terlebih dahulu.");
                return;
            }

            if (currentIndex === questions.length - 1) {
                submitAnswers();
                return;
            }

            currentIndex++;
            loadQuestion(false);
            setTimeout(() => loadQuestion(true), 300);
        }

        // Back
        function prevQuestion() {
            if (currentIndex === 0) return;

            currentIndex--;
            loadQuestion(false);
            setTimeout(() => loadQuestion(true), 300);
        }

        // Helper untuk merender list dari array
        function renderList(title, array) {
            if (!array || array.length === 0) return '';
            let listHtml = `<div class="result-section"><h5>${title}</h5><ul class="result-list">`;
            array.forEach(item => {
                listHtml += `<li>${item}</li>`;
            });
            listHtml += `</ul></div>`;
            return listHtml;
        }

        // Submit
        function submitAnswers() {
            document.getElementById("question-screen").style.display = "none";
            document.getElementById("loading-screen").style.display = "block";

            // Set teks loading awal
            updateLoadingText("1/3: Menghitung kecocokan karir menggunakan model ML...");

            fetch("http://127.0.0.1:5000/predict", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(Object.fromEntries(
                        Object.entries(answers).map(([k, v]) => [`q${parseInt(k)+1}`, v])
                    ))
                })
                .then(res => {
                    // Cek jika response tidak OK (misal 500, 503)
                    if (!res.ok) {
                        return res.json().then(errorData => {
                            throw new Error(errorData.error || `Server error: ${res.status}`);
                        });
                    }

                    // Langkah 2: Panggilan LLM berhasil (response diterima)
                    updateLoadingText(
                        "2/3: Menganalisis jalur karir dan sertifikasi dengan AI (membutuhkan waktu)...");
                    return res.json();
                })
                .then(data => {
                    // Langkah 3: Data diterima dan diproses untuk ditampilkan
                    updateLoadingText("3/3: Menyimpan data ke database Neo4j...");

                    // Jeda sebentar sebelum menampilkan hasil (simulasi penulisan DB)
                    setTimeout(() => {
                        document.getElementById("loading-screen").style.display = "none";
                        document.getElementById("result-screen").style.display = "block";

                        const roadmap = data.learning_path;

                        // --- 1. Rekomendasi Karir Utama ---
                        let html = `
                            <div class="result-section">
                                <h5>Rekomendasi Karir Utama (Top 3)</h5>
                                <ul class='list-group'>
                        `;
                        data.top_3_career_recommendation.forEach(i => {
                            html +=
                                `<li class="list-group-item bg-dark text-info"><b>${i[0]}</b> - Skor: ${i[1].toFixed(3)}</li>`;
                        });
                        html += `</ul></div>`;

                        // --- 2. Ringkasan Karir (dari Gemini) ---
                        // Tambahkan tautan untuk melihat Graph di sini
                        html += `
                            <div class="result-section">
                                <h5>Karir Utama yang Disarankan: ${roadmap.primary_role}</h5>
                                <p>${roadmap.why_suited}</p>
                                <a href="graph.html" target="_blank" class="btn btn-sm btn-outline-info rounded-pill">Lihat Peta Keterampilan (Graph)</a>
                            </div>
                        `;

                        // --- 3. Learning Path (Beginner, Intermediate, Advanced) ---
                        html += `
                            <div class="result-section">
                                <h5>Jalur Pembelajaran Terperinci</h5>
                                <p class="text-secondary small">Panduan langkah demi langkah berdasarkan peran inti yang direkomendasikan.</p>
                            </div>
                        `;
                        html += renderList('Level 1: Dasar (Beginner)', roadmap.learning_path.beginner);
                        html += renderList('Level 2: Menengah (Intermediate)', roadmap.learning_path
                            .intermediate);
                        html += renderList('Level 3: Lanjutan (Advanced)', roadmap.learning_path.advanced);


                        // --- 4. Sertifikasi dan Proyek ---
                        html += renderList('Sertifikasi yang Direkomendasikan', roadmap
                            .recommended_certifications);
                        html += renderList('Proyek yang Disarankan', roadmap.recommended_projects);


                        // --- 5. Probabilitas Lengkap (Opsional) ---
                        html +=
                            `<hr><p class="text-secondary small">Probabilitas lengkap untuk semua kategori karir:</p><p>`;
                        for (const [k, v] of Object.entries(data.probabilities)) {
                            html += `${k}: <b>${v.toFixed(3)}</b><br>`;
                        }
                        html += `</p>`;

                        document.getElementById("result").innerHTML = html;
                    }, 500); // Penambahan jeda 500ms agar update teks loading Neo4j terlihat
                })
                .catch(err => {
                    document.getElementById("loading-screen").style.display = "none";
                    document.getElementById("question-screen").style.display = "block"; // Kembali ke kuesioner
                    showMessage("Gagal terhubung ke backend atau terjadi kesalahan server! Detail: " + err.message);
                });
        }
    </script>

</body>

</html>